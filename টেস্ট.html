<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Smart Evaluator Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode:'class',
      theme:{
        extend:{
          colors:{
            brand:'#2563eb',
            accent:'#10b981'
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">

<!-- HEADER -->
<header class="flex justify-between items-center px-6 py-3 bg-brand text-white">
  <h1 class="text-xl font-bold">Smart Group Evaluator</h1>
  <button id="themeToggle" class="bg-white/20 px-3 py-1 rounded hover:bg-white/30">ЁЯМЩ</button>
</header>

<div class="flex min-h-screen">
  <!-- SIDEBAR -->
  <aside class="w-60 bg-white dark:bg-gray-800 border-r dark:border-gray-700">
    <nav class="p-4 space-y-3">
      <button data-page="home" class="navBtn w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">ЁЯПа Dashboard</button>
      <button data-page="groups" class="navBtn w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">ЁЯСе Groups</button>
      <button data-page="tasks" class="navBtn w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">ЁЯУМ Tasks</button>
      <button data-page="eval" class="navBtn w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">ЁЯУК Evaluation</button>
      <button data-page="export" class="navBtn w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">ЁЯТ╛ Export / Reset</button>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="flex-1 p-6 space-y-6">
    <!-- DASHBOARD -->
    <section id="page-home" class="page">
      <h2 class="text-xl font-semibold mb-4">Dashboard</h2>
      <div class="grid sm:grid-cols-3 gap-4">
        <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
          <p class="text-sm text-gray-500 dark:text-gray-400">ржорзЛржЯ ржЧрзНрж░рзБржк</p>
          <h3 id="cardGroups" class="text-2xl font-bold">0</h3>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
          <p class="text-sm text-gray-500 dark:text-gray-400">ржорзЛржЯ ржЯрж╛рж╕рзНржХ</p>
          <h3 id="cardTasks" class="text-2xl font-bold">0</h3>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
          <p class="text-sm text-gray-500 dark:text-gray-400">ржЧрзЬ рж╕рзНржХрзЛрж░</p>
          <h3 id="cardAvg" class="text-2xl font-bold">0</h3>
        </div>
      </div>
    </section>

    <!-- GROUPS -->
    <section id="page-groups" class="page hidden">
      <h2 class="text-xl font-semibold mb-4">ржЧрзНрж░рзБржк ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ</h2>
      <div class="flex gap-2 mb-4">
        <input id="groupName" placeholder="ржЧрзНрж░рзБржкрзЗрж░ ржирж╛ржо" class="border rounded px-3 py-2 flex-1 dark:bg-gray-700">
        <button id="addGroup" class="bg-accent text-white px-4 py-2 rounded">Add</button>
      </div>
      <ul id="groupList" class="space-y-2"></ul>
    </section>

    <!-- TASKS -->
    <section id="page-tasks" class="page hidden">
      <h2 class="text-xl font-semibold mb-4">ржЯрж╛рж╕рзНржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ</h2>
      <div class="flex gap-2 mb-4">
        <input id="taskName" placeholder="ржЯрж╛рж╕рзНржХрзЗрж░ ржирж╛ржо" class="border rounded px-3 py-2 flex-1 dark:bg-gray-700">
        <button id="addTask" class="bg-accent text-white px-4 py-2 rounded">Add</button>
      </div>
      <ul id="taskList" class="space-y-2"></ul>
    </section>

    <!-- EVALUATION -->
    <section id="page-eval" class="page hidden">
      <h2 class="text-xl font-semibold mb-4">ржорзВрж▓рзНржпрж╛рзЯржи</h2>
      <select id="evalGroup" class="border rounded px-3 py-2 mb-4 dark:bg-gray-700"></select>
      <div id="evalTable"></div>
    </section>

    <!-- EXPORT -->
    <section id="page-export" class="page hidden">
      <h2 class="text-xl font-semibold mb-4">Export / Reset</h2>
      <button id="exportCSV" class="bg-brand text-white px-4 py-2 rounded mr-3">Export CSV</button>
      <button id="resetAll" class="bg-red-600 text-white px-4 py-2 rounded">Reset All</button>
    </section>
  </main>
</div>

<script>
const App = {
  state:{groups:[],tasks:[],theme:'light'},
  save(){localStorage.setItem('evalApp',JSON.stringify(this.state));},
  load(){const d=localStorage.getItem('evalApp');if(d) this.state=JSON.parse(d);},

  init(){
    this.load();
    if(this.state.theme==='dark')document.documentElement.classList.add('dark');
    this.bind();
    this.renderAll();
  },

  bind(){
    document.querySelectorAll('.navBtn').forEach(btn=>{
      btn.onclick=()=>this.showPage(btn.dataset.page);
    });
    document.getElementById('themeToggle').onclick=()=>{
      document.documentElement.classList.toggle('dark');
      this.state.theme=document.documentElement.classList.contains('dark')?'dark':'light';
      this.save();
    };
    document.getElementById('addGroup').onclick=()=>{
      const n=document.getElementById('groupName').value.trim();
      if(!n) return;
      this.state.groups.push({name:n,scores:{}});
      document.getElementById('groupName').value='';
      this.save();this.renderGroups();this.renderCards();
    };
    document.getElementById('addTask').onclick=()=>{
      const n=document.getElementById('taskName').value.trim();
      if(!n) return;
      this.state.tasks.push(n);
      document.getElementById('taskName').value='';
      this.save();this.renderTasks();this.renderCards();
    };
    document.getElementById('evalGroup').onchange=()=>this.renderEval();
    document.getElementById('exportCSV').onclick=()=>this.exportCSV();
    document.getElementById('resetAll').onclick=()=>{if(confirm('рж╕ржм ржбрзЗржЯрж╛ ржорзБржЫрждрзЗ ржЪрж╛ржУ?')){localStorage.removeItem('evalApp');location.reload();}};
  },

  showPage(p){
    document.querySelectorAll('.page').forEach(pg=>pg.classList.add('hidden'));
    document.getElementById('page-'+p).classList.remove('hidden');
  },

  renderAll(){
    this.renderCards();this.renderGroups();this.renderTasks();this.renderEval();
  },

  renderCards(){
    document.getElementById('cardGroups').textContent=this.state.groups.length;
    document.getElementById('cardTasks').textContent=this.state.tasks.length;
    const scores=[];
    this.state.groups.forEach(g=>scores.push(...Object.values(g.scores||{})));
    const avg=scores.length?(scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(2):0;
    document.getElementById('cardAvg').textContent=avg;
  },

  renderGroups(){
    const ul=document.getElementById('groupList');
    ul.innerHTML=this.state.groups.map((g,i)=>`<li class="bg-white dark:bg-gray-700 px-3 py-2 rounded shadow flex justify-between"><span>${g.name}</span><span class="text-sm text-gray-500">${Object.keys(g.scores||{}).length} scores</span></li>`).join('');
    const sel=document.getElementById('evalGroup');
    sel.innerHTML='<option value="">ржЧрзНрж░рзБржк ржирж┐рж░рзНржмрж╛ржЪржи</option>'+this.state.groups.map((g,i)=>`<option value="${i}">${g.name}</option>`).join('');
  },

  renderTasks(){
    document.getElementById('taskList').innerHTML=this.state.tasks.map(t=>`<li class="bg-white dark:bg-gray-700 px-3 py-2 rounded shadow">${t}</li>`).join('');
  },

  renderEval(){
    const sel=document.getElementById('evalGroup');
    const idx=sel.value;
    const area=document.getElementById('evalTable');
    if(idx===''||!this.state.tasks.length){area.innerHTML='<p class="text-gray-500">ржЧрзНрж░рзБржк ржУ ржЯрж╛рж╕рзНржХ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</p>';return;}
    const g=this.state.groups[idx];
    if(!g.scores)g.scores={};
    let html=`<table class="w-full text-sm border">
    <thead class="bg-gray-200 dark:bg-gray-700"><tr><th class="border px-2 py-1">Task</th><th class="border px-2 py-1">Score</th></tr></thead><tbody>`;
    this.state.tasks.forEach(t=>{
      const v=g.scores[t]??'';
      html+=`<tr><td class="border px-2 py-1">${t}</td><td class="border px-2 py-1"><input data-task="${t}" type="number" min="0" max="10" value="${v}" class="score w-24 px-2 py-1 rounded border dark:bg-gray-800"></td></tr>`;
    });
    html+=`</tbody></table><p class="mt-3 font-semibold">ржорзЛржЯ: <span id="sum"></span></p>`;
    area.innerHTML=html;
    area.querySelectorAll('.score').forEach(inp=>{
      inp.oninput=e=>{
        g.scores[e.target.dataset.task]=Number(e.target.value)||0;
        this.save();this.updateSum(g);
      };
    });
    this.updateSum(g);
  },

  updateSum(g){
    const arr=Object.values(g.scores||{});
    const sum=arr.reduce((a,b)=>a+b,0);
    const avg=arr.length?(sum/arr.length).toFixed(2):0;
    document.getElementById('sum').textContent=`${sum} (Avg: ${avg})`;
    this.renderCards();
  },

  exportCSV(){
    let rows=[['Group','Task','Score']];
    this.state.groups.forEach(g=>{
      this.state.tasks.forEach(t=>{
        rows.push([g.name,t,g.scores?.[t]??'']);
      });
    });
    const csv=rows.map(r=>r.join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='evaluation.csv';
    a.click();
  }
};
window.addEventListener('DOMContentLoaded',()=>App.init());
</script>

</body>
</html>
